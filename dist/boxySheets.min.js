function BoxySheet(){function load(t){$$boxy.sheets.loaded=t,$$boxy.sheets.active=t,$$boxy.sheets.stack=[],buildBoxy(t),layout(),events(),_(window).resize()}function events(){var t={},e={window:window,"(@window)":window};__($$boxy.media).forEach(function(o){var i=$$boxy.media[o];__(i).forEach(function(i){var s=$$boxy.media[o][i],n=o.split("."),a=e[n[0]];_(a).on(n[1],function(){var e=!1,n=boxyEvalProp(i);if(e){if(n==t[conditon])return;t[i]=n}n?buildBoxy(s,o):buildBoxy($$boxy.sheets.loaded),layout()})})})}function addGuideLine(t,e,o,i){var s;i=i||1,s=document.createElement("div"),s.className="boxyGuide boxy-guide-"+t,s.setAttribute("alt",t+" : "+e),s.style.position="absolute",s.style.cursor="crosshair",s.style.backgroundColor="rgba(255, 0, 0, 0.5)","left"==e||"right"==e?(s.style.width=i+"px",s.style.height=$(document).height(),s.style.left=o):(s.style.top=o,s.style.width=$(window).width(),s.style.height=i+"px"),document.body.appendChild(s)}function clearGuideLines(){for(var t=document.querySelectorAll(".boxyGuide"),e=0;e<t.length;e++)document.body.removeChild(t.item(e))}function layout(){var t,e,o;clearGuideLines(),__($$boxy.guides).forEach(function(t){var e=["left","right","top","bottom"],o=$$boxy.guides[t];o["show-guide"]&&e.forEach(function(e){o[e]&&addGuideLine(t,e,boxyEvalProp(o[e].value),o["show-guide"].value)})}),__($$boxy.items).forEach(function(i){t=$$boxy.items[i],t.elements&&t.elements.toArray().forEach(function(s){__(t.properties).forEach(function(n){o=parseProperty(t.properties[n]),e=boxyEval.call(s,o),setProperty(i,n,e,s)})})})}function setElementStyle(t,e){var o=this;__(e).forEach(function(t){var i=boxyEvalProp(e[t].value||e[t]);(i||0===i)&&setProperty(_(o),t,i)})}function setProperty(t,e,o,i){var s,n,a={};if("_"==e.charAt(0))e=e.substring(1);else if(s="boxy-"+e,"function"==typeof _(t)[s])return _(t)[s](o);return"animate"==(n=e.split("-"))[0]?(a={},a[n[1]]=o,_(t).stop(),_(t).animate(a)):"function"==typeof _(i)[e]?_(i||t)[e](o):"undefined"!=typeof $$boxy.styles.style[("webkit-"+e).camelCase()]||"undefined"!=typeof $$boxy.styles.style[("moz-"+e).camelCase()]||"undefined"!=typeof $$boxy.styles.style[e.camelCase()]?_(i||t).css(e,o):(console.log("No setter for:",e),void console.log("unable to set:",t,o))}function buildBoxy(t){var e,o,i;document.getElementById("BoxySheet")||document.head.appendChild($$boxy.styles),$$boxy.sheets.active=t,__(t).forEach(function(s){e=t[s],__(e).forEach(function(t){if(o=e[t].value||"",$$boxy.items[s]=$$boxy.items[s]||{properties:{}},$$boxy.items[s].properties[t]=parseProperty(o),$$boxy.items[s].state=null,("."==s.charAt(0)||"#"==s.charAt(0))&&!$$boxy.items[s].elements){var n="",a=s,c=a,l=$$boxy.styles.sheet.cssRules.length;if(a.indexOf("::")>0){if(a=a.split("::"),a[1]=a[1].replace(/[^a-zA-Z0-9\-]/g,""),"function"==typeof elementEvent[a[1]])return void elementEvent[a[1]](_(a[0]),a[0],e);return}$$boxy.items[s]&&($$boxy.items[s].elements=$$boxy.items[s].elements||_(s)),a.indexOf(":")>0&&(a=a.split(":"),a[1]=a[1].replace(/[^a-zA-Z0-9\-]/g,""),c=a[0]+".-boxy-"+a[1],n="-boxy-"+a[1],a[1]=a[1].replace(/:.*/,"")),$$boxy.styles.sheet.insertRule(c+" { position: absolute; }",l),_(s).each(function(){var t=_(this).data("boxy-items")||[],e=$$boxy.styles.sheet.cssRules.length;t.push(s),_(this).data("boxy-items",t),$$boxy.styles.sheet.insertRule((r=c+".boxy-index-"+e)+"{ position: absolute; }",e),_(this).addClass("boxy-index-"+e),_(this).addClass(n),_(this).data("boxy-index",e)})}if("@"==s.charAt(0)){i=s.match(/([^\ \(]+)?([^\(]+)?(\([^\:]+)?(:)?(.+)?/);var h=i[1].substring(1),f=(i[2]||"").trim(),y=i[3]||"",u=i[5]||"(@window).resize";"guide"==h&&($$boxy.guides[f]=$$boxy.guides[f]||{},__(e).forEach(function(t){$$boxy.guides[f][t]=e[t]})),"media"==h&&($$boxy.media[u]=$$boxy.media[u]||{},$$boxy.media[u][y]=e)}})})}function parseProperty(t){var e,o="getProperty.call";if(void 0===t)return"";if(!t.match)return t;if(e=t.match(/\([\#\.\@][\ \:\w]+\)(\.[\w]+)(\.[\-\w]+)?/g)){var i=t;return e.forEach(function(t){var e=t.match(/\((.+)\)\.(.+)/);i=i.replace(t,o+"(this,'"+e[1]+"','"+e[2]+"')")}),"'"==t.charAt(0)&&"{"==t.charAt(1)&&(i=i.substring(1,i.length-1)),i}return t}function boxyEval(val){if("undefined"!=typeof val&&"undefined"!=typeof val){if(val.indexOf&&val.indexOf("'")<0&&val.indexOf("(")<0&&(val=parseFloat(val)),"string"==typeof val&&"{"==val.charAt(0)){var obj=JSON.parse(val);return __(obj).forEach(function(t){obj[t]=boxyEval(obj[t])}),obj}return eval(val)}}function boxyEvalProp(t){return boxyEval(parseProperty(t))}function getProperty(t,e){var o,i,s;if("@"==t.charAt(0)){if("@this"==t)return o=$(this).data(e),"function"==typeof _(this)[e]?"index"==e?$(this).data().boxyIndex:_(this)[e]():o;if("@window"==t){if(s=e.split("."),"function"==typeof _(window)[e])return _(window)[e]();if("undefined"!=typeof window[e])return window[e]}if("@guide"==t){if(s=e.split("."),!s[0]||!s[1])throw e;return i=$$boxy.guides[s[0]][s[1]].value,o=boxyEval(parseProperty(i))}return!1}if("#"==t.charAt(0)||"."==t.charAt(0)){var n="boxy-get-"+e;return"top"==e?parseFloat(_(t).css("top")):"left"==e?parseFloat(_(t).css("left")):"right"==e?_(t).width()+parseFloat(_(t).css("left")||0):"bottom"==e?_(t).height()+parseFloat(_(t).css("top")||0):"function"==typeof _(t)[n]?_(t)[n]():"function"==typeof _(t)[e]?_(t)[e]():"function"==typeof _(t)[n]?_(t)[n]():"function"==typeof _(t)[e]?_(t)[e]():_(t).css(e)}}var _,__=Object.keys,style=document.createElement("style");style.setAttribute("id","BoxySheet"),"undefined"!=typeof jQuery&&(_=jQuery),"undefined"!=typeof Zepto&&(_=Zepto),$$boxy={items:{},guides:{},media:{},sheets:{},styles:style},boxyFn(_),_.fn.bxy=function(t,e){_(this).each(function(){var o=_(this).data("boxy-index"),i=$$boxy.styles.sheet.cssRules.item(o).style;return void 0===e||""===e?void i.removeProperty(t):(e==parseFloat(e)&&t.indexOf("-")<0&&(e+="px"),void i.setProperty(t,e))})},$$boxy.topLayer=1,_.fn["boxy-layer"]=function(t){"top"==t&&(t=++$$boxy.topLayer),_(this).bxy("z-index",t)},_.fn["boxy-middle"]=function(t){var e=t/2-_(this).height()/2;_(this).bxy("top",e)},_.fn["boxy-center"]=function(t){var e=t/2-_(this).width()/2;_(this).bxy("left",e)},_.fn["boxy-alignment"]=function(t){if(this.selector){var e=($$boxy.items[this.selector].properties,{center:function(){},midpoint:function(){_(this).each(function(){var t=_(this).text();_(this).css("text-align","center"),0==_(this).children().length&&(_(this).html(""),_(this).append('<div class="boxy-fill">'+t+"</div>"));var e=_(this).height(),o=_(this).children().height();_(this).children().css("font-size");_(this).children().css("position","absolute"),_(this).css("width")&&_(this).children().css("width",_(this).css("width")),_(this).children().css("top",(e-o)/2),_(this).children().css("margin",0),_(this).children().css("padding",0)})}});"function"==typeof e[t]&&e[t].call(this,t)}},_.fn["boxy-gap"]=function(t){},_.fn["boxy-layout"]=function(t){if(this.selector){var e=$$boxy.items[this.selector].properties,o={gap:boxyEval(e.gap)||0,space:boxyEval(e.space)||0,top:boxyEval(e["top-side"])||0,bottom:boxyEval(e["bottom-side"])||0,left:boxyEval(e["left-side"])||0,right:boxyEval(e["right-side"])||0,across:boxyEval(e.across)||0,down:boxyEval(e.down)||0},i={"float":function(t,e){var o=0,i=0,s=0,n=t.left+t.space,a=t.top+t.space;_(this).each(function(e){i=_(this).height(),i>s&&(s=i),o=_(this).width(),_(this).bxy("left",n),_(this).bxy("top",a),n=n+o+t.gap,n+o>=t.right&&(n=t.left+t.gap,a=a+s+t.gap,s=0)})},fit:function(t,e){var o,i,s,n;o=t.left+t.space,i=t.top+t.space,t.right>t.left&&(s=(t.right-2*t.space-t.left-((t.across||1)-1)*t.gap)/(t.across||1)),t.bototm>t.top&&(n=(t.bottom-2*t.space-t.top-((t.down||1)-1)*t.gap)/(t.down||1)),s>0&&(e.width=s),n>0&&(e.height=n),_(this).each(function(a){var c=a%e.across,r=Math.floor(a/e.across);o=c*(s+t.gap)+t.left+t.space,i=r*(n+t.gap)+t.top+t.space,_(this).bxy("top",i),_(this).bxy("left",o)})},fill:function(t,e){var o=t.right-t.space-(t.left+t.space),i=t.bottom-t.space-(t.top+t.space);_(this).bxy("top",t.top+t.space),_(this).bxy("left",t.left+t.space),_(this).width(o),_(this).height(i),e.width=o,e.height=i}};"function"==typeof i[t]&&($$boxy.items[this.selector].state!=t&&i[t].call(this,o,e),$$boxy.items[this.selector].state=t)}},_.fn["boxy-animate"]=function(t){return _(this).animate(t),null},_.fn["boxy-down"]=function(t){return null},_.fn["boxy-across"]=function(t){return null},_.fn["boxy-position"]=function(t){var e=$$boxy.items[this.selector].properties;e.position=t,_(this).bxy("position",t)},_.fn["boxy-space"]=function(t){},_.fn["boxy-bottom-side"]=function(t){},_.fn["boxy-top-side"]=function(t){},_.fn["boxy-right-side"]=function(t){},_.fn["boxy-left-side"]=function(t){},_.fn["boxy-background"]=function(t){_(this).bxy("background-color",t)},_.fn["boxy-test"]=function(t){_(this).bxy("background-color",t),_(this).bxy("color",t)},_.fn["boxy-left"]=function(t){if(this.selector){var e=$$boxy.items[this.selector].properties;e.layout||_(this).bxy("left",t)}},_.fn["boxy-top"]=function(t){if(this.selector){var e=$$boxy.items[this.selector].properties;e.layout||_(this).bxy("top",t)}},_.fn["boxy-height"]=function(t){console.log(t),"auto"==t&&(t=$(this).children().height()),_(this).height(t)},_.fn["boxy-bottom"]=function(t){_(this).height(t-_(this).offset().top)},_.fn["boxy-middle"]=function(t){t-=_(this).height()/2,_(this).bxy("top",t)},_.fn["boxy-width"]=function(t){_(this).bxy("width",t)},_.fn["boxy-height"]=function(t){_(this).bxy("height",t)};var elementEvent={touchstart:function(t,e,o){_(t).touchstart(function(){setElementStyle.call(this,t,o)})},touchend:function(t,e,o){_(t).touchend(function(){setElementStyle.call(this,t,o)})},clicked:function(t,e,o){_(t).data("boxy-style-clicked",o)},click:function(t,e,o){_(t).data("boxy-style-click",o),_(t).unbind("click"),_(t).click(function(e){var i=_(this).data("boxy-style-clicked");i&&1==_(this).data("boxy-clicked")?(o=i,_(this).data("boxy-clicked",!1)):(o=_(t).data("boxy-style-click"),_(this).data("boxy-clicked",!0)),setElementStyle.call(this,t,o),e.preventDefault()})},hover:function(t,e,o){_(t).unbind("mouseout"),_(t).unbind("mouseover"),_(t).mouseover(function(){setElementStyle.call(this,t,o)}),_(t).mouseout(function(){var e=this;_(this).data("boxy-items").forEach(function(o){var i={},s=$$boxy.items[o].properties;__(s).forEach(function(t){i[t]=s[t]||""}),setElementStyle.call(e,t,i)})})}},elementEvent={touchstart:function(t,e,o){_(t).touchstart(function(){setElementStyle.call(this,t,o)})},touchend:function(t,e,o){_(t).touchend(function(){setElementStyle.call(this,t,o)})},clicked:function(t,e,o){_(t).data("boxy-style-clicked",o)},click:function(t,e,o){_(t).data("boxy-style-click",o),_(t).unbind("click"),_(t).click(function(e){var i=_(this).data("boxy-style-clicked");i&&1==_(this).data("boxy-clicked")?(o=i,_(this).data("boxy-clicked",!1)):(o=_(t).data("boxy-style-click"),_(this).data("boxy-clicked",!0)),setElementStyle.call(this,t,o),e.preventDefault()})},hover:function(t,e,o){_(t).unbind("mouseout"),_(t).unbind("mouseover"),_(t).mouseover(function(){setElementStyle.call(this,t,o)}),_(t).mouseout(function(){var e=this;_(this).data("boxy-items").forEach(function(o){var i={},s=$$boxy.items[o].properties;__(s).forEach(function(t){i[t]=s[t]||""}),setElementStyle.call(e,t,i)})})}};return $$boxy.topLayer=1,$$boxy.layout=layout,{load:load,layout:layout,getProperty:getProperty}}function boxyFn(t){t.fn.bxy=function(e,o){t(this).each(function(){var i=t(this).data("boxy-index"),s=$$boxy.styles.sheet.cssRules.item(i).style;return void 0===o||""===o?void s.removeProperty(e):(o==parseFloat(o)&&e.indexOf("-")<0&&(o+="px"),void s.setProperty(e,o))})},t.fn["boxy-layer"]=function(e){"top"==e&&(e=++$$boxy.topLayer),t(this).bxy("z-index",e)},t.fn["boxy-middle"]=function(e){var o=e/2-t(this).height()/2;t(this).bxy("top",o)},t.fn["boxy-center"]=function(e){var o=e/2-t(this).width()/2;t(this).bxy("left",o)},t.fn["boxy-alignment"]=function(e){if(this.selector){var o=($$boxy.items[this.selector].properties,{center:function(){},midpoint:function(){t(this).each(function(){var e=t(this).text();t(this).css("text-align","center"),0==t(this).children().length&&(t(this).html(""),t(this).append('<div class="boxy-fill">'+e+"</div>"));var o=t(this).height(),i=t(this).children().height();t(this).children().css("font-size");t(this).children().css("position","absolute"),t(this).css("width")&&t(this).children().css("width",t(this).css("width")),t(this).children().css("top",(o-i)/2),t(this).children().css("margin",0),t(this).children().css("padding",0)})}});"function"==typeof o[e]&&o[e].call(this,e)}},t.fn["boxy-gap"]=function(t){},t.fn["boxy-layout"]=function(e){if(this.selector){var o=$$boxy.items[this.selector].properties,i={gap:boxyEval(o.gap)||0,space:boxyEval(o.space)||0,top:boxyEval(o["top-side"])||0,bottom:boxyEval(o["bottom-side"])||0,left:boxyEval(o["left-side"])||0,right:boxyEval(o["right-side"])||0,across:boxyEval(o.across)||0,down:boxyEval(o.down)||0},s={"float":function(e,o){var i=0,s=0,n=0,a=e.left+e.space,c=e.top+e.space;t(this).each(function(o){s=t(this).height(),s>n&&(n=s),i=t(this).width(),t(this).bxy("left",a),t(this).bxy("top",c),a=a+i+e.gap,a+i>=e.right&&(a=e.left+e.gap,c=c+n+e.gap,n=0)})},fit:function(e,o){var i,s,n,a;i=e.left+e.space,s=e.top+e.space,e.right>e.left&&(n=(e.right-2*e.space-e.left-((e.across||1)-1)*e.gap)/(e.across||1)),e.bottom>e.top&&(a=(e.bottom-2*e.space-e.top-((e.down||1)-1)*e.gap)/(e.down||1)),n>0&&(o.width=n),a>0&&(o.height=a),t(this).each(function(c){var r=c%o.across,l=Math.floor(c/o.across);i=r*(n+e.gap)+e.left+e.space,s=l*(a+e.gap)+e.top+e.space,t(this).bxy("top",s),t(this).bxy("left",i)})},fill:function(e,o){var i=e.right-e.space-(e.left+e.space),s=e.bottom-e.space-(e.top+e.space);t(this).bxy("top",e.top+e.space),t(this).bxy("left",e.left+e.space),t(this).width(i),t(this).height(s),o.width=i,o.height=s}};"function"==typeof s[e]&&($$boxy.items[this.selector].state!=e&&s[e].call(this,i,o),$$boxy.items[this.selector].state=e)}},t.fn["boxy-animate"]=function(e){return e=JSON.parse(e)||e,t(this).animate(e),null},t.fn["boxy-down"]=function(t){return null},t.fn["boxy-across"]=function(t){return null},t.fn["boxy-position"]=function(e){var o=$$boxy.items[this.selector].properties;o.position=e,t(this).bxy("position",e)},t.fn["boxy-space"]=function(t){},t.fn["boxy-bottom-side"]=function(t){},t.fn["boxy-top-side"]=function(t){},t.fn["boxy-right-side"]=function(t){},t.fn["boxy-left-side"]=function(t){},t.fn["boxy-background"]=function(e){t(this).bxy("background-color",e)},t.fn["boxy-test"]=function(e){t(this).bxy("background-color",e),t(this).bxy("color",e)},t.fn["boxy-left"]=function(e){if(this.selector){var o=$$boxy.items[this.selector].properties;o.layout||t(this).bxy("left",e)}},t.fn["boxy-top"]=function(e){if(this.selector){var o=$$boxy.items[this.selector].properties;o.layout||t(this).bxy("top",e)}},t.fn["boxy-height"]=function(e){"auto"==e&&(e=$(this).children().height()),t(this).height(e)},t.fn["boxy-bottom"]=function(e){t(this).height(e-t(this).offset().top)},t.fn["boxy-middle"]=function(e){e-=t(this).height()/2,t(this).bxy("top",e)},t.fn["boxy-width"]=function(e){t(this).bxy("width",e)},t.fn["boxy-height"]=function(e){t(this).bxy("height",e)},t.fn.rotate=function(e){t(this).css("transform","rotate("+e/Math.PI*180+"deg)")}}var $$boxy=new Object;String.prototype.camelCase=function(){return this.toString().replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})};
