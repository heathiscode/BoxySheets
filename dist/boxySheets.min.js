function BoxySheet(){function load(t){$$boxy.sheets.loaded=t,$$boxy.sheets.active=t,$$boxy.sheets.stack=[],buildBoxy(t),layout(),events(),_(window).resize()}function events(){var t={},e={"(@window)":window};__($$boxy.media).forEach(function(o){var i=$$boxy.media[o];__(i).forEach(function(i){var s=$$boxy.media[o][i],n=o.split("."),r=e[n[0]];_(r).on(n[1],function(){var e=!1,n=boxyEvalProp(i),r=t[i]||null;e&&(t[i]=n,n==r)||(n?buildBoxy(s,o):buildBoxy($$boxy.sheets.loaded),layout())})})})}function boxyEval(val){return val.indexOf&&val.indexOf("'")<0&&val.indexOf("(")<0&&(val=parseFloat(val)),eval(val)}function addGuideLine(t,e,o){div=document.createElement("div"),div.className="boxyGuide boxy-guide-"+t,div.setAttribute("alt",t+" : "+e),div.style.position="absolute",div.style.cursor="crosshair",div.style.backgroundColor="rgba(255, 0, 0, 0.5)","left"==e||"right"==e?(div.style.width="1",div.style.height=$(document).height(),div.style.left=o):(div.style.top=o,div.style.width=$(window).width(),div.style.height="1px"),document.body.appendChild(div)}function clearGuideLines(){for(var t=document.querySelectorAll(".boxyGuide"),e=0;e<t.length;e++)document.body.removeChild(t.item(e))}function layout(){var t,e,o;clearGuideLines();var i=["left","right","top","bottom"];__($$boxy.guides).forEach(function(t){var e=$$boxy.guides[t];e["show-lines"]&&i.forEach(function(o){e[o]&&addGuideLine(t,o,boxyEvalProp(e[o].value))})}),__($$boxy.items).forEach(function(i){t=$$boxy.items[i],t.elements&&t.elements.toArray().forEach(function(s){__(t.properties).forEach(function(n){o=parseProperty(t.properties[n]),e=boxyEval.call(s,o),setProperty(i,n,e)})})})}function setProperty(t,e,o){var i;return i="boxy-"+e,"function"==typeof _(t)[i]?_(t)[i](o):"function"==typeof _(t)[e]?_(t)[e](o):(console.log("No setter for:",e),void console.log("unable to set:",t,o))}function buildBoxy(t){var e,o,i;document.getElementById("BoxySheet")||document.head.appendChild($$boxy.styles),$$boxy.sheets.active=t,__(t).forEach(function(s){e=t[s],__(e).forEach(function(t){if(o=e[t].value||"",$$boxy.items[s]=$$boxy.items[s]||{properties:{}},$$boxy.items[s].properties[t]=parseProperty(o),("."==s.charAt(0)||"#"==s.charAt(0))&&!$$boxy.items[s].elements){var n=s;$$boxy.items[n].elements=_(s);var r=$$boxy.styles.sheet.cssRules.length;n.indexOf(":")>0&&(n=n.split(":"),_(n[0]+":"+n[1]).addClass("-boxy-"+n[1]),n=n[0]+".-boxy-"+n[1]),$$boxy.styles.sheet.insertRule(n+" { position: absolute; }",r),_(s).each(function(){var t=$$boxy.styles.sheet.cssRules.length;$$boxy.styles.sheet.insertRule(n+".boxy-index-"+t+" { position: absolute; }",t),_(this).addClass("boxy-index-"+t),_(this).data("boxy-index",t)})}if("@"==s.charAt(0)){i=s.match(/([^\ \(]+)?([^\(]+)?(\([^\:]+)?(:)?(.+)?/);var a=i[1].substring(1),y=(i[2]||"").trim(),l=i[3]||"",h=i[5]||"(@window).resize";"guide"==a&&($$boxy.guides[y]=$$boxy.guides[y]||{},__(e).forEach(function(t){$$boxy.guides[y][t]=e[t]})),"media"==a&&($$boxy.media[h]=$$boxy.media[h]||{},$$boxy.media[h][l]=e)}})})}function parseProperty(t){var e,o="getProperty.call";if(void 0===t)return"";if(!t.match)return t;if(e=t.match(/\([\#\.\@][\ \:\w]+\)(\.\w+)(\.\w+)?/g)){var i=t;return e.forEach(function(t){var e=t.match(/\((.+)\)\.(.+)/);i=i.replace(t,o+'(this,"'+e[1]+'","'+e[2]+'")')}),i}return t}function boxyEvalProp(t){return boxyEval(parseProperty(t))}function getProperty(t,e){var o,i,s;if("@"==t.charAt(0)){if("@this"==t&&"function"==typeof _(this)[e])return _(this)[e]();if("@window"==t&&(s=e.split("."),"function"==typeof _(window)[e]))return _(window)[e]();if("@guide"==t){if(s=e.split("."),!s[0]||!s[1])throw e;return i=$$boxy.guides[s[0]][s[1]].value,o=boxyEval(parseProperty(i))}return!1}return"#"==t.charAt(0)||"."==t.charAt(0)?"function"==typeof _(t)[e]?_(t)[e]():"right"==e?_(t).width()+parseFloat(_(t).css("left")):"bottom"==e?_(t).height()+parseFloat(_(t).css("top")):_(t).css(e):void 0}var _,__=Object.keys,style=document.createElement("style");return style.setAttribute("id","BoxySheet"),"undefined"!=typeof jQuery&&(_=jQuery),"undefined"!=typeof Zepto&&(_=Zepto),$$boxy={items:{},guides:{},media:{},sheets:{},styles:style},_.fn.bxy=function(t,e){_(this).each(function(){var o=_(this).data("boxy-index"),i=$$boxy.styles.sheet.cssRules.item(o).style;return void 0==e||""==e?void i.removeProperty(t):void i.setProperty(t,e)})},_.fn["boxy-alignment"]=function(t){var e=($$boxy.items[this.selector].properties,{center:function(){},midpoint:function(){_(this).each(function(){var t=_(this).text();_(this).css("text-align","center"),0==_(this).children().length&&(_(this).html(""),_(this).append('<div class="boxy-fill">'+t+"</div>"));var e=_(this).height(),o=_(this).children().height();_(this).children().css("font-size");_(this).children().css("position","absolute"),_(this).css("width")&&_(this).children().css("width",_(this).css("width")),_(this).children().css("top",(e-o)/2),_(this).children().css("margin",0),_(this).children().css("padding",0)})}});"function"==typeof e[t]&&e[t].call(this,t)},_.fn["boxy-gap"]=function(t){},_.fn["boxy-down"]=function(t){var e,o,i,s=$$boxy.items[this.selector].properties,n=boxyEval(parseProperty(s.gap||0)),r=boxyEval(parseProperty(s.space))||0;if("clear"!=t){if("auto"==t&&(t=_(this).length),o=boxyEval(parseProperty(s["top-side"])),e=(boxyEval(parseProperty(s["bottom-side"]))+n-2*r-o)/t,0>e&&(t="layout",s.height=_(this).height()),"fill"==t)return e=boxyEvalProp(s["bottom-side"])-(o=boxyEvalProp(s["top-side"])),_(this).bxy("top",o+r),s["top-side"]=o,void(s.height=e-2*r);"layout"==t&&(e+=n),_(this).each(function(a){var y=a*e+o+r;"layout"==t&&(i=boxyEval(parseProperty(s.height))||_(this).height(),y=o+(i+n)*a+r),_(this).bxy("top",y),_(this).bxy("height",e-n)})}},_.fn["boxy-across"]=function(t){var e,o,i,s=$$boxy.items[this.selector].properties,n=boxyEval(parseProperty(s.gap))||0,r=boxyEval(parseProperty(s.space))||0;return"clear"==t?void _(this).bxy("left",s.left?s.left:""):("auto"==t&&(t=_(this).length),"fill"==t?(e=boxyEvalProp(s["right-side"])-(o=boxyEvalProp(s["left-side"])),_(this).bxy("left",o+r),s["left-side"]=o,void(s.width=e-2*r)):(e=(boxyEval(parseProperty(s["right-side"]))+n-2*r-(o=boxyEval(parseProperty(s["left-side"]))))/t,"layout"==t&&(i=boxyEval(parseProperty(s.width))||_(this).width(),e=i+n),_(this).each(function(s){var a=s*e+o+r;"layout"==t&&(a=o+(i+n)*s+r),_(this).bxy("left",a),_(this).bxy("width",e-n)}),void(s.width=e-n)))},_.fn["boxy-space"]=function(t){},_.fn["boxy-bottom-side"]=function(t){},_.fn["boxy-top-side"]=function(t){},_.fn["boxy-right-side"]=function(t){},_.fn["boxy-left-side"]=function(t){},_.fn["boxy-left"]=function(t){_(this).bxy("left",t)},_.fn["boxy-background"]=function(t){_(this).bxy("background",t)},_.fn["boxy-top"]=function(t){_(this).bxy("top",t)},_.fn["boxy-bottom"]=function(t){_(this).height(t-_(this).offset().top)},_.fn["boxy-middle"]=function(t){t-=_(this).height()/2,_(this).bxy("top",t)},_.fn["boxy-width"]=function(t){_(this).bxy("width",t)},_.fn["boxy-height"]=function(t){_(this).bxy("height",t)},$$boxy.layout=layout,{load:load,layout:layout,getProperty:getProperty}}var $$boxy=new Object;
